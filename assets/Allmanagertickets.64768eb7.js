import{r as n,K as te,W as ae,v as o,j as t,B as j,M as S}from"./index.4455fcbe.js";import{s as R,S as re,C as se,I as ne,f as oe,g as ie,h as P,b as ce,T as de}from"./App.e864e2a1.js";import{h as le}from"./moment.ef14f9cc.js";import{C as he}from"./createhelpdesk.cab6b217.js";import{B as pe}from"./Backbutton.c79d50ef.js";const ge=R.button`
  background-color: #0C1539 !important;
  width: 200px;
  padding: 10px;
  color: white;
  cursor: pointer;
  border-radius: 10px!important;
  transition: background-color 0.3s;

  &:hover {
    background-color: #1a2447 !important;
  }
`;R.button`
  background-color:rgb(231, 231, 231) !important;
  width: 300px;
  padding: 10px;
  color: black;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s;
`;const Se=()=>{const[x,L]=n.exports.useState(!1),[$,A]=n.exports.useState([]),[C,q]=n.exports.useState(""),[_,O]=n.exports.useState([]),[v,ue]=n.exports.useState("newest");n.exports.useState(!1);const[d,Y]=n.exports.useState(1),[p]=n.exports.useState(5),[z,N]=n.exports.useState(!1),g=te(),[y,F]=n.exports.useState(!1),i=localStorage.getItem("user_role"),G=ae(),u=new URLSearchParams(G.search).get("tab")||"1",I=()=>{F(!y)},k=localStorage.getItem("authToken"),l=localStorage.getItem("user_id"),[U,H]=n.exports.useState({}),w=async()=>{try{if(!k){g("/login"),console.error("No token found, please login.");return}let e="https://bapi.reownlogics.com/api/help-desk",a={department_manager_id:l};const r={2:7,3:4,4:3,5:2,7:6};u==="6"?(e="https://bapi.reownlogics.com/api/help-desk",a={manager_status_id:3,department_manager_id:l,employee_status_id:6}):r[u]&&(a={manager_status_id:r[u],department_manager_id:l});const s=await S.get(e,{params:a,headers:{Authorization:`Bearer ${k}`}});console.log("Fetching tickets with:",r[u],l),console.log("sortedemployees",s.data);const c=s.data.sort((m,f)=>new Date(f.created_at)-new Date(m.created_at));O(c)}catch(e){console.error("Error fetching employee data: ",e)}finally{N(!1)}};n.exports.useEffect(()=>{N(!0),w()},[k,g]);const K=(e,a)=>v==="newest"?new Date(a.createdAt)-new Date(e.createdAt):v==="oldest"?new Date(e.createdAt)-new Date(a.createdAt):0,h=_.filter(e=>e.title.toLowerCase().includes(C.toLowerCase())).sort(K),B=d*p,V=B-p,W=h.slice(V,B),D=e=>Y(e),J=()=>{L(!x),A(x?[]:_.map(e=>e.id))},Q=e=>{A(a=>a.includes(e)?a.filter(r=>r!==e):[...a,e])},X=async()=>{try{const e=localStorage.getItem("authToken");if(!e){console.error("No token found, redirecting to login."),g("/login");return}const a=[...new Set(h.map(s=>s.department.id))];console.log("Department IDs:",a);const r={};for(let s of a){const c=await S.get(`https://bapi.reownlogics.com/api/department/assistants?department_id=${s}`,{headers:{Authorization:`Bearer ${e}`}});Array.isArray(c.data)?r[s]=c.data:Array.isArray(c.data.department)?r[s]=c.data.department:console.error("Unexpected API response:",c.data)}H(r)}catch(e){console.error("API error:",e)}};n.exports.useEffect(()=>{h.length>0&&X()},[h]);const Z=async(e,a)=>{e.preventDefault();const r=parseInt(e.target.value,10);if(!r){console.error("Assistant selection is required");return}try{const s=await S.post("https://bapi.reownlogics.com/api/help-desk/assign",{assistant_id:r,help_desk_id:a},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`}});console.log("Manager assigned successfully:",s.data),w()}catch(s){console.error("Error assigning manager:",s)}};return z?o("div",{className:"d-flex justify-content-center align-items-center fs-3",style:{height:"calc(100vh - 170px)"},children:[t(re,{}),t("span",{className:"fs-2",style:{paddingBottom:"6px",paddingLeft:"5px"}})]}):o("div",{children:[o("div",{className:"d-flex justify-content-between align-items-center",children:[t(pe,{}),t(ge,{className:"mb-2",onClick:I,children:"+ Create New"}),t(he,{isOpen:y,toggle:I,refreshTickets:w})]}),o(se,{className:"bg-white ticket-card",style:{borderRadius:"30px"},children:[o("div",{className:"p-2 d-flex justify-content-between align-items-center",children:[t("div",{children:t("h3",{children:"Recent Ticket"})}),t("div",{className:"d-flex align-items-center justify-content-end",children:o(ne,{className:"mr-3",children:[t(oe,{children:t(ie,{size:16})}),t(P,{placeholder:"Search by name",value:C,onChange:e=>q(e.target.value)})]})})]}),o(ce,{children:[o(de,{responsive:!0,className:"table-ticket",children:[t("thead",{children:o("tr",{children:[t("th",{children:t("input",{type:"checkbox",checked:x,onChange:J})}),t("th",{children:"Name"}),t("th",{children:"Description"}),t("th",{children:"Assign By"}),t("th",{children:"Created at"}),t("th",{children:"Requested Time"}),(i==="hr"||i==="manager"||i==="employee")&&t("th",{children:"Rating"}),t("th",{children:"Status"}),(i==="hr"||i==="manager")&&t("th",{children:"Assign to"}),t("th",{children:"Actions"})]})}),t("tbody",{children:W.map(e=>{var c,m,f,T,M,E;const a=((c=e.department)==null?void 0:c.id)||null,r=U[a]||[],s=le(e.created_at);return o("tr",{children:[t("td",{children:t("input",{type:"checkbox",checked:$.includes(e.id),onChange:()=>Q(e.id)})}),t("td",{children:e.title}),t("td",{children:e!=null&&e.description?e.description.length>3?`${e.description.slice(0,30)}...`:e.description:"No description available"}),t("td",{children:((f=(m=e.department)==null?void 0:m.manager)==null?void 0:f.name)||"N/A"}),t("td",{children:t("span",{style:{background:"rgba(58, 151, 76, 0.1)",padding:"10px",borderRadius:"100px",color:"#3A974C"},children:s.format("YYYY-MM-DD")})}),t("td",{children:t("span",{children:s.format("hh:mm:ss A")})}),(i==="hr"||i==="manager"||i==="employee")&&t("td",{children:((T=e.reviews)==null?void 0:T.length)>0?e.reviews[0].rating:"No rating"}),t("td",{children:t("span",{style:{background:"rgba(58, 151, 76, 0.1)",padding:"10px",borderRadius:"100px",color:"#3A974C"},children:e.status})}),(i==="hr"||i==="manager")&&t("td",{children:e.status==="rejected"?t("span",{children:"Can't assign, it's rejected"}):e.assigned_to===null?((E=(M=e==null?void 0:e.department)==null?void 0:M.manager)==null?void 0:E.id)===Number(l)&&(e==null?void 0:e.requested_by)!==Number(l)?o(P,{type:"select",name:"select",onChange:b=>Z(b,e.id),children:[t("option",{value:"",children:"Select Assistant"}),r.length>0?r.map((b,ee)=>t("option",{value:b.assistant.id,children:b.assistant.name},ee)):t("option",{disabled:!0,children:"No managers available"})]}):t("span",{children:"You cannot assign"}):t("span",{children:e.assistant.name})}),t("td",{children:t("button",{type:"button",onClick:()=>g(`/ticket-detail/${e.id}`),className:"btn btn-outline-primary rounded-pill",children:"View"})})]},e.id)})})]}),o("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[t(j,{disabled:d===1,onClick:()=>D(d-1),children:"Previous"}),o("div",{children:["Page ",d," of ",Math.ceil(h.length/p)]}),t(j,{disabled:d===Math.ceil(h.length/p),onClick:()=>D(d+1),children:"Next"})]})]})]})]})};export{Se as default};
