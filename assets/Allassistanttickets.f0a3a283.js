import{r,K as F,W as H,v as a,j as t,B as v,M as K}from"./index.6f6a8d80.js";import{s as A,S as U,C as W,I as J,f as Q,g as V,h as X,b as Z,T as ee}from"./App.c605b380.js";import{h as N}from"./moment.ef14f9cc.js";import{C as te}from"./createhelpdesk.7d4db264.js";import{B as se}from"./Backbutton.039e979b.js";const ae=A.button`
  background-color: #0C1539 !important;
  width: 200px;
  padding: 10px;
  color: white;
  cursor: pointer;
  border-radius: 10px!important;
  transition: background-color 0.3s;

  &:hover {
    background-color: #1a2447 !important;
  }
`;A.button`
  background-color:rgb(231, 231, 231) !important;
  width: 300px;
  padding: 10px;
  color: black;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s;
`;const he=()=>{const[l,B]=r.exports.useState(!1),[D,g]=r.exports.useState([]),[m,E]=r.exports.useState(""),[f,T]=r.exports.useState([]),[b,re]=r.exports.useState("newest");r.exports.useState(!1);const[o,M]=r.exports.useState(1),[d]=r.exports.useState(5),[P,x]=r.exports.useState(!1),h=F(),[k,R]=r.exports.useState(!1),j=H(),i=new URLSearchParams(j.search).get("tab")||"1",w=()=>{R(!k)},p=localStorage.getItem("authToken"),c=localStorage.getItem("user_id"),S=async()=>{x(!0);try{if(!p){h("/login"),console.error("No token found, please login.");return}let e="https://bapi.reownlogics.com/api/help-desk",s={assigned_to_id:c};const n={4:2};i==="2"&&(e=`https://bapi.reownlogics.com/api/help-desk/completed_by_assistant/${c}`,s={}),i==="3"&&(e=`https://bapi.reownlogics.com/api/help-desk?employee_status_id=2&assigned_to_id=${c}`,s={}),i==="5"?(e=`https://bapi.reownlogics.com/api/help-desk/reopen_tickets_for_assistant/${c}`,s={}):n[i]&&(s={assigned_status_id:n[i],assigned_to_id:c});const _=await K.get(e,{params:s,headers:{Authorization:`Bearer ${p}`}});console.log("sortedemployees",_.data);const q=_.data.sort((G,z)=>new Date(z.created_at)-new Date(G.created_at));T(q)}catch(e){console.error("Error fetching employee data: ",e)}finally{x(!1)}};r.exports.useEffect(()=>{S()},[p,h]);const I=(e,s)=>b==="newest"?new Date(s.createdAt)-new Date(e.createdAt):b==="oldest"?new Date(e.createdAt)-new Date(s.createdAt):0,u=f.filter(e=>e.title.toLowerCase().includes(m.toLowerCase())).sort(I),y=o*d,L=y-d,$=u.slice(L,y),C=e=>M(e),O=()=>{B(!l),g(l?[]:f.map(e=>e.id))},Y=e=>{g(s=>s.includes(e)?s.filter(n=>n!==e):[...s,e])};return P?a("div",{className:"d-flex justify-content-center align-items-center fs-3",style:{height:"calc(100vh - 170px)"},children:[t(U,{}),t("span",{className:"fs-2",style:{paddingBottom:"6px",paddingLeft:"5px"}})]}):a("div",{children:[a("div",{className:"d-flex justify-content-between align-items-center",children:[t(se,{}),t(ae,{className:"mb-2",onClick:w,children:"+ Create New"}),t(te,{isOpen:k,toggle:w,refreshTickets:S})]}),a(W,{className:"bg-white ticket-card",style:{borderRadius:"30px"},children:[a("div",{className:"p-2 d-flex justify-content-between align-items-center",children:[t("div",{children:t("h3",{children:"Recent Ticket"})}),t("div",{className:"d-flex align-items-center justify-content-end",children:a(J,{className:"mr-3",children:[t(Q,{children:t(V,{size:16})}),t(X,{placeholder:"Search by name",value:m,onChange:e=>E(e.target.value)})]})})]}),a(Z,{children:[a(ee,{responsive:!0,className:"table-ticket",children:[t("thead",{children:a("tr",{children:[t("th",{children:t("input",{type:"checkbox",checked:l,onChange:O})}),t("th",{children:"Name"}),t("th",{children:"Description"}),t("th",{children:"Assign By"}),t("th",{children:"Created at"}),t("th",{children:"Requested Time"}),t("th",{children:"Status"}),t("th",{children:"Actions"})]})}),t("tbody",{children:$.map(e=>{var s,n;return a("tr",{children:[t("td",{children:t("input",{type:"checkbox",checked:D.includes(e.id),onChange:()=>Y(e.id)})}),t("td",{children:e.title}),t("td",{children:e!=null&&e.description?e.description.length>3?`${e.description.slice(0,30)}...`:e.description:"No description available"}),t("td",{children:(n=(s=e.department)==null?void 0:s.manager)!=null&&n.name?e.department.manager.name:"N/A"}),t("td",{children:t("span",{style:{background:"rgba(58, 151, 76, 0.1)",padding:"10px",borderRadius:"100px",color:"#3A974C"},children:N(e.created_at).format("YYYY-MM-DD ")})}),t("td",{children:t("span",{children:N(e.created_at).format("hh:mm:ss A")})}),t("td",{children:t("span",{style:{background:"rgba(58, 151, 76, 0.1)",padding:"10px",borderRadius:"100px",color:"#3A974C"},children:e.status})}),t("td",{children:t("button",{type:"button",onClick:()=>h(`/ticket-detail/${e.id}`),className:"btn btn-outline-primary rounded-pill",children:"view"})})]},e.id)})})]}),a("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[t(v,{disabled:o===1,onClick:()=>C(o-1),children:"Previous"}),a("div",{children:["Page ",o," of ",Math.ceil(u.length/d)]}),t(v,{disabled:o===Math.ceil(u.length/d),onClick:()=>C(o+1),children:"Next"})]})]})]})]})};export{he as default};
