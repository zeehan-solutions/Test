import{r as n,K as X,v as o,j as t,B as T,M as b}from"./index.b5bd9156.js";import{s as R,C as Z,I as ee,f as te,g as re,h as E,b as ae,T as se}from"./App.6937329a.js";import{h as M}from"./moment.ef14f9cc.js";import{C as ne}from"./createhelpdesk.0d3a71cb.js";import{B as oe}from"./Backbutton.88aa0173.js";const ie=R.button`
  background-color: #0C1539 !important;
  width: 200px;
  padding: 10px;
  color: white;
  cursor: pointer;
  border-radius: 10px!important;
  transition: background-color 0.3s;

  &:hover {
    background-color: #1a2447 !important;
  }
`;R.button`
  background-color:rgb(231, 231, 231) !important;
  width: 300px;
  padding: 10px;
  color: black;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s;
`;const ue=()=>{const[u,j]=n.exports.useState(!1),[P,x]=n.exports.useState([]),[k,O]=n.exports.useState(""),[w,Y]=n.exports.useState([]),[y,ce]=n.exports.useState("newest");n.exports.useState(!1);const[d,$]=n.exports.useState(1),[h]=n.exports.useState(5),i=localStorage.getItem("user_role"),A=localStorage.getItem("user_id"),p=X(),[S,q]=n.exports.useState(!1),[z,L]=n.exports.useState({}),C=()=>{q(!S)},m=localStorage.getItem("authToken"),F=localStorage.getItem("user_id"),f=async()=>{try{if(m){const e=await b.get("https://bapi.reownlogics.com/api/help-desk",{params:{employee_id:F},headers:{Authorization:`Bearer ${m}`}});console.log("sortedemployees",e.data);const r=e.data.sort((s,a)=>new Date(a.created_at)-new Date(s.created_at));Y(r)}else console.log("No token found. Please log in again."),p("/login")}catch(e){console.error("Error fetching employee data: ",e)}};n.exports.useEffect(()=>{f()},[m,p]);const G=(e,r)=>y==="newest"?new Date(r.createdAt)-new Date(e.createdAt):y==="oldest"?new Date(e.createdAt)-new Date(r.createdAt):0,l=w.filter(e=>e.title.toLowerCase().includes(k.toLowerCase())).sort(G),I=d*h,H=I-h,K=l.slice(H,I),N=e=>$(e),U=()=>{j(!u),x(u?[]:w.map(e=>e.id))},V=e=>{x(r=>r.includes(e)?r.filter(s=>s!==e):[...r,e])},J=async()=>{try{const e=localStorage.getItem("authToken");if(!e){console.error("No token found, redirecting to login."),p("/login");return}const r=[...new Set(l.map(a=>a.department.id))];console.log("Department IDs:",r);const s={};for(let a of r){const c=await b.get(`https://bapi.reownlogics.com/api/department/assistants?department_id=${a}`,{headers:{Authorization:`Bearer ${e}`}});Array.isArray(c.data)?s[a]=c.data:Array.isArray(c.data.department)?s[a]=c.data.department:console.error("Unexpected API response:",c.data)}L(s)}catch(e){console.error("API error:",e)}};n.exports.useEffect(()=>{l.length>0&&J()},[l]);const Q=async(e,r)=>{e.preventDefault();const s=parseInt(e.target.value,10);if(!s){console.error("Assistant selection is required");return}try{const a=await b.post("https://bapi.reownlogics.com/api/help-desk/assign",{assistant_id:s,help_desk_id:r},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`}});console.log("Manager assigned successfully:",a.data),f()}catch(a){console.error("Error assigning manager:",a)}};return o("div",{children:[o("div",{className:"d-flex justify-content-between align-items-center",children:[t(oe,{}),t(ie,{className:"mb-2",onClick:C,children:"+ Create New"}),t(ne,{isOpen:S,toggle:C,refreshTickets:f})]}),o(Z,{className:"bg-white ticket-card",style:{borderRadius:"30px"},children:[o("div",{className:"p-2 d-flex justify-content-between align-items-center",children:[t("div",{children:t("h3",{children:"Recent Ticket"})}),t("div",{className:"d-flex align-items-center justify-content-end",children:o(ee,{className:"mr-3",children:[t(te,{style:{borderRight:0},children:t(re,{size:16})}),t(E,{placeholder:"Search by name",value:k,onChange:e=>O(e.target.value),style:{borderLeft:0}})]})})]}),o(ae,{children:[o(se,{responsive:!0,className:"table-ticket",children:[t("thead",{children:o("tr",{children:[t("th",{children:t("input",{type:"checkbox",checked:u,onChange:U})}),t("th",{children:"Name"}),t("th",{children:"Requested Date"}),t("th",{children:"Requested Time"}),t("th",{children:"Assign By"}),(i==="hr"||i==="manager"||i==="employee")&&t("th",{children:"Rating"}),t("th",{children:"Status"}),(i==="hr"||i==="manager")&&t("th",{children:"Assign to"}),t("th",{children:"Actions"})]})}),t("tbody",{children:K.map(e=>{var a,c,v,_,D,B;const r=((a=e.department)==null?void 0:a.id)||null,s=z[r]||[];return o("tr",{children:[t("td",{children:t("input",{type:"checkbox",checked:P.includes(e.id),onChange:()=>V(e.id)})}),t("td",{children:e.title}),t("td",{children:t("span",{style:{background:"rgba(58, 151, 76, 0.1)",padding:"10px",borderRadius:"100px",color:"#3A974C"},children:M(e.created_at).format("YYYY-MM-DD")})}),t("td",{children:M(e.created_at).format("hh:mm:ss A")}),t("td",{children:((v=(c=e.department)==null?void 0:c.manager)==null?void 0:v.name)||"N/A"}),(i==="hr"||i==="manager"||i==="employee")&&t("td",{children:((_=e.reviews)==null?void 0:_.length)>0?e.reviews[0].rating:"No rating"}),t("td",{children:t("span",{style:{background:"rgba(58, 151, 76, 0.1)",padding:"10px",borderRadius:"100px",color:"#3A974C"},children:e.status})}),(i==="hr"||i==="manager")&&t("td",{children:e.status==="rejected"?t("span",{children:"Can't assign, it's rejected"}):e.assigned_to===null?((B=(D=e.department)==null?void 0:D.manager)==null?void 0:B.id)===Number(A)&&e.requested_by!==Number(A)?o(E,{type:"select",name:"select",onChange:g=>Q(g,e.id),children:[t("option",{value:"",children:"Select Assistant"}),s.length>0?s.map((g,W)=>t("option",{value:g.assistant.id,children:g.assistant.name},W)):t("option",{disabled:!0,children:"No managers available"})]}):t("span",{children:"You cannot assign"}):t("span",{children:e.assistant.name})}),t("td",{children:t("button",{type:"button",onClick:()=>p(`/ticket-detail/${e.id}`),className:"btn btn-outline-primary rounded-pill",children:"View"})})]},e.id)})})]}),o("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[t(T,{disabled:d===1,onClick:()=>N(d-1),children:"Previous"}),o("div",{children:["Page ",d," of ",Math.ceil(l.length/h)]}),t(T,{disabled:d===Math.ceil(l.length/h),onClick:()=>N(d+1),children:"Next"})]})]})]})]})};export{ue as default};
