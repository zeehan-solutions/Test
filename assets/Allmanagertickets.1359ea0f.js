import{r as a,K as Z,v as o,j as t,B as M,M as x}from"./index.b5bd9156.js";import{s as P,S as ee,C as te,I as re,f as ne,g as se,h as j,b as ae,T as oe}from"./App.6937329a.js";import{h as ie}from"./moment.ef14f9cc.js";import{C as ce}from"./createhelpdesk.0d3a71cb.js";import{B as de}from"./Backbutton.88aa0173.js";const le=P.button`
  background-color: #0C1539 !important;
  width: 200px;
  padding: 10px;
  color: white;
  cursor: pointer;
  border-radius: 10px!important;
  transition: background-color 0.3s;

  &:hover {
    background-color: #1a2447 !important;
  }
`;P.button`
  background-color:rgb(231, 231, 231) !important;
  width: 300px;
  padding: 10px;
  color: black;
  border: none;
  cursor: pointer;
  transition: background-color 0.3s;
`;const be=()=>{const[u,R]=a.exports.useState(!1),[$,k]=a.exports.useState([]),[w,L]=a.exports.useState(""),[S,O]=a.exports.useState([]),[A,he]=a.exports.useState("newest");a.exports.useState(!1);const[d,Y]=a.exports.useState(1),[h]=a.exports.useState(5),[z,C]=a.exports.useState(!1),g=Z(),[N,q]=a.exports.useState(!1),i=localStorage.getItem("user_role"),v=()=>{q(!N)},m=localStorage.getItem("authToken"),f=localStorage.getItem("user_id"),[G,F]=a.exports.useState({}),b=async()=>{try{if(m){const e=await x.get(`https://bapi.reownlogics.com/api/help-desk?department_manager_id=${f}`,{headers:{Authorization:`Bearer ${m}`}});console.log("sortedemployees",e.data);const r=e.data.sort((s,n)=>new Date(n.created_at)-new Date(s.created_at));O(r)}else console.log("No token found. Please log in again."),g("/login")}catch(e){console.error("Error fetching employee data: ",e)}finally{C(!1)}};a.exports.useEffect(()=>{C(!0),b()},[m,g]);const H=(e,r)=>A==="newest"?new Date(r.createdAt)-new Date(e.createdAt):A==="oldest"?new Date(e.createdAt)-new Date(r.createdAt):0,l=S.filter(e=>e.title.toLowerCase().includes(w.toLowerCase())).sort(H),I=d*h,K=I-h,U=l.slice(K,I),y=e=>Y(e),V=()=>{R(!u),k(u?[]:S.map(e=>e.id))},J=e=>{k(r=>r.includes(e)?r.filter(s=>s!==e):[...r,e])},Q=async()=>{try{const e=localStorage.getItem("authToken");if(!e){console.error("No token found, redirecting to login."),g("/login");return}const r=[...new Set(l.map(n=>n.department.id))];console.log("Department IDs:",r);const s={};for(let n of r){const c=await x.get(`https://bapi.reownlogics.com/api/department/assistants?department_id=${n}`,{headers:{Authorization:`Bearer ${e}`}});Array.isArray(c.data)?s[n]=c.data:Array.isArray(c.data.department)?s[n]=c.data.department:console.error("Unexpected API response:",c.data)}F(s)}catch(e){console.error("API error:",e)}};a.exports.useEffect(()=>{l.length>0&&Q()},[l]);const W=async(e,r)=>{e.preventDefault();const s=parseInt(e.target.value,10);if(!s){console.error("Assistant selection is required");return}try{const n=await x.post("https://bapi.reownlogics.com/api/help-desk/assign",{assistant_id:s,help_desk_id:r},{headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("authToken")}`}});console.log("Manager assigned successfully:",n.data),b()}catch(n){console.error("Error assigning manager:",n)}};return z?o("div",{className:"d-flex justify-content-center align-items-center fs-3",style:{height:"calc(100vh - 170px)"},children:[t(ee,{}),t("span",{className:"fs-2",style:{paddingBottom:"6px",paddingLeft:"5px"}})]}):o("div",{children:[o("div",{className:"d-flex justify-content-between align-items-center",children:[t(de,{}),t(le,{className:"mb-2",onClick:v,children:"+ Create New"}),t(ce,{isOpen:N,toggle:v,refreshTickets:b})]}),o(te,{className:"bg-white ticket-card",style:{borderRadius:"30px"},children:[o("div",{className:"p-2 d-flex justify-content-between align-items-center",children:[t("div",{children:t("h3",{children:"Recent Ticket"})}),t("div",{className:"d-flex align-items-center justify-content-end",children:o(re,{className:"mr-3",children:[t(ne,{children:t(se,{size:16})}),t(j,{placeholder:"Search by name",value:w,onChange:e=>L(e.target.value)})]})})]}),o(ae,{children:[o(oe,{responsive:!0,className:"table-ticket",children:[t("thead",{children:o("tr",{children:[t("th",{children:t("input",{type:"checkbox",checked:u,onChange:V})}),t("th",{children:"Name"}),t("th",{children:"Description"}),t("th",{children:"Assign By"}),t("th",{children:"Created at"}),t("th",{children:"Requested Time"}),(i==="hr"||i==="manager"||i==="employee")&&t("th",{children:"Rating"}),t("th",{children:"Status"}),(i==="hr"||i==="manager")&&t("th",{children:"Assign to"}),t("th",{children:"Actions"})]})}),t("tbody",{children:U.map(e=>{var c,B,D,_,T,E;const r=((c=e.department)==null?void 0:c.id)||null,s=G[r]||[],n=ie(e.created_at);return o("tr",{children:[t("td",{children:t("input",{type:"checkbox",checked:$.includes(e.id),onChange:()=>J(e.id)})}),t("td",{children:e.title}),t("td",{children:e!=null&&e.description?e.description.length>3?`${e.description.slice(0,30)}...`:e.description:"No description available"}),t("td",{children:((D=(B=e.department)==null?void 0:B.manager)==null?void 0:D.name)||"N/A"}),t("td",{children:t("span",{style:{background:"rgba(58, 151, 76, 0.1)",padding:"10px",borderRadius:"100px",color:"#3A974C"},children:n.format("YYYY-MM-DD")})}),t("td",{children:t("span",{children:n.format("hh:mm:ss A")})}),(i==="hr"||i==="manager"||i==="employee")&&t("td",{children:((_=e.reviews)==null?void 0:_.length)>0?e.reviews[0].rating:"No rating"}),t("td",{children:t("span",{style:{background:"rgba(58, 151, 76, 0.1)",padding:"10px",borderRadius:"100px",color:"#3A974C"},children:e.status})}),(i==="hr"||i==="manager")&&t("td",{children:e.status==="rejected"?t("span",{children:"Can't assign, it's rejected"}):e.assigned_to===null?((E=(T=e==null?void 0:e.department)==null?void 0:T.manager)==null?void 0:E.id)===Number(f)&&(e==null?void 0:e.requested_by)!==Number(f)?o(j,{type:"select",name:"select",onChange:p=>W(p,e.id),children:[t("option",{value:"",children:"Select Assistant"}),s.length>0?s.map((p,X)=>t("option",{value:p.assistant.id,children:p.assistant.name},X)):t("option",{disabled:!0,children:"No managers available"})]}):t("span",{children:"You cannot assign"}):t("span",{children:e.assistant.name})}),t("td",{children:t("button",{type:"button",onClick:()=>g(`/ticket-detail/${e.id}`),className:"btn btn-outline-primary rounded-pill",children:"View"})})]},e.id)})})]}),o("div",{className:"d-flex justify-content-between align-items-center mt-3",children:[t(M,{disabled:d===1,onClick:()=>y(d-1),children:"Previous"}),o("div",{children:["Page ",d," of ",Math.ceil(l.length/h)]}),t(M,{disabled:d===Math.ceil(l.length/h),onClick:()=>y(d+1),children:"Next"})]})]})]})]})};export{be as default};
